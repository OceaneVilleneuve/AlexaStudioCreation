/* 
*      Robo Gallery     
*      Version: 3.2.14 - 40722
*      By Robosoft
*
*      Contact: https://robogallery.co/ 
*      Created: 2021
*      Licensed under the GPLv2 license - http://opensource.org/licenses/gpl-2.0.php

 */
!function(){const o={get(e){return window.fetch(e,{method:"GET",headers:{Accept:"application/json"}}).then(this._handleError).then(this._handleContentType).catch(this._throwError)},post(e,t){return window.fetch(e,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then(this._handleError).then(this._handleContentType).catch(this._throwError)},_handleError(e){return e.ok?e:Promise.reject(e.statusText)},_handleContentType(e){const t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():Promise.reject("Oops, we haven't got JSON!")},_throwError(e){throw new Error(e)}};var a,i,s,c,d="gallery-library",n=document.getElementById("robo_gallery_images_preview"),t=document.getElementsByClassName("roboGalleryFieldImagesButton"),p=[];function r(e){jQuery(n);var t=roboGalleryFieldGallery.endpoint+"/images/";o.get(t+e).then(e=>{n.textContent="",e.forEach(e=>{var t=document.createElement("img");t.setAttribute("src",e.url),t.setAttribute("data-id",e.id),n.appendChild(t)})})}0!=t.length?(t=t[0],s=document.getElementById(t.getAttribute("data-id")),i=s.value,c=""==i?[]:i.split(","),r(i),void 0!==roboGalleryFieldGallery.preview_click&&roboGalleryFieldGallery.preview_click&&n.addEventListener("click",function(e){e.preventDefault(),e.target.matches("img")&&t.click()}),t.addEventListener("click",function(e){var l;i=s.value,c=""==i?[]:i.split(","),a||(0<c.length&&(d="gallery-edit"),(a=new wp.media.view.emWpGallery({multiple:!0,state:d,library:{order:"ASC",orderby:"title",type:"image",search:null,uploadedTo:null,multiple:!0}})).on("ready",function(){}),l=0,a.on("open",function(){i=s.value,c=""==i?[]:i.split(",");var e=a.state().get("library"),t=performance.now();e.reset();var o,n=performance.now();console.log(`Call to reset took ${n-t} milliseconds`);const r=function(e){p.hasMore()&&p.more().then(()=>{console.log("col",l++),r(p)})};0!=c.length&&(o=[],p=wp.media.query({post__in:c,posts_per_page:50}),r(p),t=performance.now(),c.forEach(function(e){o.push(wp.media.attachment(e))}),n=performance.now(),console.log(`Call to push took ${n-t} milliseconds`),t=performance.now(),e.add(o),n=performance.now(),console.log(`Call to library.add took ${n-t} milliseconds`),"gallery-edit"!=d&&(a.setState("gallery-edit"),a.options.state="gallery-edit",d="gallery-edit"))}),a.on("insert",function(){a.state().get("selection")}),a.on("update",function(e){var t=a.state(),t=e||t.get("selection");if(t){var o=t.toJSON();if(0!=o.length){c=[];for(var n=0;n<o.length;n++)c.push(o[n].id);r(i=c.join(",")),s.value=i}}else console.log("return selection")})),a.open()}),Sortable.create(n,{group:"robo_gallery_images_preview",animation:100,store:{get:function(e){var t=s.value;return""==t?[]:t.split(",")},set:function(e){e=e.toArray();s.value=e.join(",")}}})):console.log("button not found ")}(jQuery);